jQuery(document).ready(function(a){function b(){this.map,this.mapOptions={zoom:Math.floor(settings.map_zoom),maxZoom:Math.floor(settings.max_zoom),center:new google.maps.LatLng(0,0),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:"0"===settings.map_styles?"":jQuery.parseJSON(settings.map_styles),draggable:"0"===settings.mouse_drag,scrollwheel:"0"===settings.mouse_scroll},this.catIndexed={},this.infoWindow=new google.maps.InfoWindow,this.filter=[]}var c=new b;google.maps.event.addDomListener(window,"load",function(){c.initMap()}),b.prototype.initMap=function(){this.indexCatData(),this.initClickEvents(),settings.center_lat&&settings.center_lng&&(this.mapOptions.center=new google.maps.LatLng(settings.center_lat,settings.center_lng)),this.map=new google.maps.Map(document.getElementById("map-canvas"),this.mapOptions),google.maps.event.addDomListener(window,"resize",function(){var a=c.map.getCenter();google.maps.event.trigger(c.map,"resize"),c.map.setCenter(a)}),settings.filter_load?this.filterLoad():this.placeMarkers(settings.fit_bounds),this.setupPOILists()},b.prototype.placeMarkers=function(b){for(var d=new google.maps.LatLngBounds,e=0,f=poi.length;f>e;e++){var g=!this.filter||"object"==typeof this.filter&&(!this.filter.length||-1!==this.filter.indexOf(poi[e].cat_id)||"1"==this.catIndexed[poi[e].cat_id].filter_resist)||("string"==typeof this.filter||"number"==typeof this.filter)&&poi[e].id==this.filter;if("undefined"!=typeof poi[e].marker)g?(poi[e].marker.setMap(this.map),d.extend(poi[e].marker.getPosition())):poi[e].marker.setMap(null);else if(g&&Number(poi[e].lat)&&Number(poi[e].lng)){var h=this.catIndexed[poi[e].cat_id],i=["filter_resist"],j=this.categoryOptionCheck(i),k=new google.maps.LatLng(poi[e].lat,poi[e].lng);if("1"!=settings.poi_num||j.indexOf(poi[e].cat_id)>-1){var l={position:k,map:this.map,title:poi[e].name};h&&(l.icon={url:""!==h.icon?h.icon:settings.poi_icon,anchor:new google.maps.Point(5,33)}),j.indexOf(poi[e].cat_id)>-1&&a.extend(l,{zIndex:8675309}),poi[e].marker=new google.maps.Marker(l)}else poi[e].marker=new MarkerWithLabel({position:k,draggable:!1,map:this.map,icon:settings.poi_icon,labelContent:poi[e].num,labelAnchor:new google.maps.Point(12,0),labelClass:"gj-maps-marker-label",labelStyle:{width:"25px",height:"25px",paddingTop:"4px",color:"white",background:h.color,"border-radius":"50%"}});google.maps.event.addListener(poi[e].marker,"click",function(a){return function(){var b=new google.maps.LatLng(poi[a].lat,poi[a].lng);c.map.panTo(b),c.showPOIInfo(poi[a])}}(e)),d.extend(k)}}var m=this.map.getBounds();("1"==b||m&&!m.intersects(d))&&"((1, 180), (-1, -180))"!=d.toString()&&this.map.fitBounds(d)},b.prototype.indexCatData=function(){for(var a=0,b=cat.length;b>a;a++)this.catIndexed[cat[a].id]=cat[a]},b.prototype.setupPOILists=function(){for(var b="",d=0;d<cat.length;d++)"1"!=cat[d].hide_list&&(b+=this.markupCategoryList(cat[d]));a(".gjmaps-categories").append(b),a(".gjmaps-category div[data-type='label']").click(function(){c.showCategoryByEl(a(this))}),0==settings.filter_load&&this.showCategoryByEl(a(".gjmaps-category[data-cat-id='all']")),this.gjmapsEvents("gjmapsCatLoad",{loaded:!0}),this.resizeCategories()},b.prototype.resizeCategories=function(){var b,c=a(".gjmaps-category");b=a(window).innerWidth()>768?c.length>2?(100-2*c.length)/c.length+"%":"50%":"100%",c.css("width",b)},b.prototype.markupCategoryList=function(a){var b,c,d,e;if(e="",d="",text=!0,"background"===settings.label_color?(a.icon?(c=a.icon.replace(/\/marker-/,"/symbol-"),e="background-image: url("+c+");"):e="",d="background-color: "+a.color+";"):"text"===settings.label_color?(e="",d="color: "+a.color+";"):"icon"===settings.label_color&&(c=a.icon.replace(/\/marker-/,"/symbol-"),e="background-image: url("+c+");",text=!1),b=text?'<li class="gjmaps-category" data-cat-id="'+a.id+'"><div style="'+e+d+'" class="gjmaps-label" data-type="label"><span>'+a.name+"</span></div><ul>":'<li class="gjmaps-category" data-cat-id="'+a.id+'"><div style="'+e+'" class="gjmaps-label" data-type="label"></div><ul>',1==settings.poi_list)for(var f=0,g=poi.length;g>f;f++)poi[f].cat_id===a.id&&(b+='<li class="poi" data-poi-id="'+poi[f].id+'">',"1"==settings.poi_num&&(b+="<span>"+poi[f].num+" </span>"),b+=poi[f].name+"</li>");return b+="</ul></li>"},b.prototype.showPOIInfo=function(b){var c,d,e,f,g;c='<div class="poi-info" style="overflow:hidden;"><h4>'+b.name+"</h4>",b.description&&(c+='<div class="description">'+b.description+"</div>"),c+='<div class="address">'+b.address+"<br>"+b.city+", "+b.state+" "+b.zip+'</div><div class="contact">',b.phone&&(g=b.phone.replace(/[\.\(\)\-\s]/g,""),c+='<a href="tel:+1'+g+'">'+b.phone+"</a>",b.url&&(c+="<br>")),b.url&&(d=b.url.replace(/^https?:\/\/|\/$/g,""),c+=settings.link_text?'<a href="'+b.url+'" target="_blank">'+settings.link_text+"</a>":'<a href="'+b.url+'" target="_blank">'+d+"</a>"),c+="</div></div>",this.infoWindow.setContent(c),this.infoWindow.open(this.map,b.marker),e=a("body"),f=a("#map-canvas").offset().top-e.position().top,a(document.body).scrollTop()>f&&a(document.body).animate({scrollTop:f},300),this.gjmapsEvents("gjmapsPOIInfo",{id:b.id,cat_id:b.cat_id})},b.prototype.showCategoryByEl=function(b){var c=b.closest(".gjmaps-category"),d=c.attr("data-cat-id");"all"===d?(this.filter=[],a("[data-cat-id='all']").addClass("active"),c.siblings(".gjmaps-category").removeClass("active"),1==settings.poi_list&&a(".gjmaps-category ul").slideDown()):(a("[data-cat-id='all']").removeClass("active"),c.siblings(".gjmaps-category").removeClass("active"),a(".gjmaps-category[data-cat-id="+d+"]").addClass("active"),1==settings.poi_list&&(c.siblings(".gjmaps-category").find("ul").slideUp(),a("ul",c).slideDown(),a(".gjmaps-category[data-cat-id="+d+"]").slideDown()),this.filter=[d]),this.gjmapsEvents("gjmapsCatClick",{category:d}),this.infoWindow.close(),this.placeMarkers(settings.fit_bounds),"all"!==d||settings.fit_bounds||(this.map.panTo(this.mapOptions.center),this.map.setZoom(this.mapOptions.zoom))},b.prototype.showCategoryByArr=function(a){this.filter=a,this.infoWindow.close(),this.placeMarkers(settings.fit_bounds)},b.prototype.filterLoad=function(){this.filter=[];for(var a=0;a<cat.length;a++)null!=cat[a].filter_resist&&this.filter.push(cat[a].id);this.placeMarkers()},b.prototype.categoryOptionCheck=function(a){for(var b=[],c=0;c<cat.length;c++)for(var d=0;d<a.length;d++)1==cat[c][a[d]]&&b.push(cat[c].id);return b},b.prototype.gjmapsEvents=function(b,c){a.event.trigger({type:b,gjmaps:c})},b.prototype.initClickEvents=function(){a("div.gjmaps-wrapper").on("click","li.poi",function(){for(var b=a(this).data("poi-id"),d=!1,e=0;poi.length>e;e++)if(poi[e].id==b){d=poi[e];break}0!=d&&c.showPOIInfo(d)}),a(document).on("click",".gjmaps-parent",function(){var b=a(this).data("cat-ids").split(",");c.showCategoryByArr(b)})}});