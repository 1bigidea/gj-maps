jQuery(document).ready(function(a){function b(){var a,b;for(t={},a=0,b=poi.length;b>a;a++)t[poi[a].id]=poi[a];for(u={},a=0,b=cat.length;b>a;a++)u[cat[a].id]=cat[a]}function c(){var b,c="";for(b=0;b<cat.length;b++)"1"!=cat[b].hide_list&&(c+=e(cat[b]));a(".gjmaps-categories").append(c),a(".gjmaps-category div[data-type='label']").click(function(){g(a(this))}),0==settings.filter_load&&g(a(".gjmaps-category[data-cat-id='all']")),n("gjmapsCatLoad",{loaded:!0}),d()}function d(){var b=a(".gjmaps-category");percent=a(window).innerWidth()>768?b.length>2?(100-2*b.length)/b.length+"%":"50%":"100%",b.css("width",percent)}function e(a){var b,c,d,e,f,g;if(g="",f="",text=!0,"background"===settings.label_color?(a.icon?(e=a.icon.replace(/\/marker-/,"/symbol-"),g="background-image: url("+e+");"):g="",f="background-color: "+a.color+";"):"text"===settings.label_color?(g="",f="color: "+a.color+";"):"icon"===settings.label_color&&(e=a.icon.replace(/\/marker-/,"/symbol-"),g="background-image: url("+e+");",text=!1),b=text?'<li class="gjmaps-category" data-cat-id="'+a.id+'"><div style="'+g+f+'" class="gjmaps-label" data-type="label"><span>'+a.name+"</span></div><ul>":'<li class="gjmaps-category" data-cat-id="'+a.id+'"><div style="'+g+'" class="gjmaps-label" data-type="label"></div><ul>',1==settings.poi_list)for(c=0,d=poi.length;d>c;c++)poi[c].cat_id===a.id&&(b+='<li class="poi" data-poi-id="'+poi[c].id+'">',"1"==settings.poi_num&&(b+="<span>"+poi[c].num+" </span>"),b+=poi[c].name+"</li>");return b+="</ul></li>"}function f(b){var c,d,e,f,g;c='<div class="poi-info" style="overflow:hidden;"><h4>'+b.name+"</h4>",b.description&&(c+='<div class="description">'+b.description+"</div>"),c+='<div class="address">'+b.address+"<br>"+b.city+", "+b.state+" "+b.zip+'</div><div class="contact">',b.phone&&(g=b.phone.replace(/[\.\(\)\-\s]/g,""),c+='<a href="tel:+1'+g+'">'+b.phone+"</a>",b.url&&(c+="<br>")),b.url&&(d=b.url.replace(/^https?:\/\/|\/$/g,""),c+=settings.link_text?'<a href="'+b.url+'" target="_blank">'+settings.link_text+"</a>":'<a href="'+b.url+'" target="_blank">'+d+"</a>"),c+="</div></div>",w.setContent(c),w.open(o,b.marker),e=a("body"),f=a("#map-canvas").offset().top-e.position().top,a(document.body).scrollTop()>f&&a(document.body).animate({scrollTop:f},300),n("gjmapsPOIInfo",{id:b.id,cat_id:b.cat_id})}function g(b){{var c;settings.mouse_scroll,settings.mouse_drag}catElement=b.closest(".gjmaps-category"),c=catElement.attr("data-cat-id"),"all"===c?(p=[],a("[data-cat-id='all']").addClass("active"),catElement.siblings(".gjmaps-category").removeClass("active"),1==settings.poi_list&&a(".gjmaps-category ul").slideDown()):(a("[data-cat-id='all']").removeClass("active"),catElement.siblings(".gjmaps-category").removeClass("active"),a(".gjmaps-category[data-cat-id="+c+"]").addClass("active"),1==settings.poi_list&&(catElement.siblings(".gjmaps-category").find("ul").slideUp(),a("ul",catElement).slideDown(),a(".gjmaps-category[data-cat-id="+c+"]").slideDown()),p=[c]),n("gjmapsCatClick",{category:c}),w.close(),j(settings.fit_bounds),"all"!==c||settings.fit_bounds||(o.panTo(q.center),o.setZoom(q.zoom))}function h(a){p=a,w.close(),j(settings.fit_bounds)}function j(a){var b,c,d,e,g;for(s=new google.maps.LatLngBounds,b=0,c=poi.length;c>b;b++)if(d=!p||"object"==typeof p&&(!p.length||-1!==p.indexOf(poi[b].cat_id)||"1"==u[poi[b].cat_id].filter_resist)||("string"==typeof p||"number"==typeof p)&&poi[b].id==p,"undefined"!=typeof poi[b].marker)d?(poi[b].marker.setMap(o),s.extend(poi[b].marker.getPosition())):poi[b].marker.setMap(null);else if(d&&Number(poi[b].lat)&&Number(poi[b].lng)){var h=u[poi[b].cat_id],i=["filter_resist"],j=l(i);e=new google.maps.LatLng(poi[b].lat,poi[b].lng),"1"!=settings.poi_num||j.indexOf(poi[b].cat_id)>-1?(g={position:e,map:o,title:poi[b].name},h&&(g.icon={url:h.icon,anchor:v}),poi[b].marker=new google.maps.Marker(g)):poi[b].marker=new MarkerWithLabel({position:e,draggable:!1,map:o,icon:settings.poi_icon,labelContent:poi[b].num,labelAnchor:new google.maps.Point(12,0),labelClass:"gj-maps-marker-label",labelStyle:{width:"25px",height:"25px",paddingTop:"4px",color:"white",background:h.color,"border-radius":"50%"}}),google.maps.event.addListener(poi[b].marker,"click",function(a){return function(){center=new google.maps.LatLng(poi[a].lat,poi[a].lng),o.panTo(center),f(poi[a])}}(b)),s.extend(e)}r=o.getBounds(),("1"==a||r&&!r.intersects(s))&&"((1, 180), (-1, -180))"!=s.toString()&&o.fitBounds(s)}function k(){p=[];for(var a=0;a<cat.length;a++)null!=cat[a].filter_resist&&p.push(cat[a].id);j()}function l(a){for(var b=[],c=0;c<cat.length;c++)for(var d=0;d<a.length;d++)1==cat[c][a[d]]&&b.push(cat[c].id);return b}function m(){var a=settings.center_lat,b=settings.center_lng,d=Math.floor(settings.map_zoom),e=Math.floor(settings.max_zoom),f=settings.mouse_scroll,g=settings.mouse_drag;q={zoom:d,maxZoom:e,center:new google.maps.LatLng(0,0),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:"0"===settings.map_styles?"":jQuery.parseJSON(settings.map_styles),draggable:"0"===g?!0:!1,scrollwheel:"0"===f?!0:!1},settings.center_lat&&settings.center_lng&&(q.center=new google.maps.LatLng(a,b)),o=new google.maps.Map(document.getElementById("map-canvas"),q),google.maps.event.addDomListener(window,"resize",function(){var a=o.getCenter();google.maps.event.trigger(o,"resize"),o.setCenter(a)}),p=[],w=new google.maps.InfoWindow,settings.filter_load?k():j(settings.fit_bounds),c()}function n(b,c){a.event.trigger({type:b,gjmaps:c})}var o,p,q,r,s,t,u,v,w;v=new google.maps.Point(5,33),b(),google.maps.event.addDomListener(window,"load",m),a("div.gjmaps-wrapper").on("click","li.poi",function(){var b=a(this).data("poi-id"),c=!1;for(i=0;poi.length>i;i++)if(poi[i].id==b){c=poi[i];break}0!=c&&f(c)}),a(document).on("click",".gjmaps-parent",function(){var b=a(this).data("cat-ids").split(",");h(b)})});